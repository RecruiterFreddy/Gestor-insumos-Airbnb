<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Gesti√≥n Inventario Airbnb</title>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/react/18.2.0/umd/react.production.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/react-dom/18.2.0/umd/react-dom.production.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/babel-standalone/7.23.5/babel.min.js"></script>
  <script src="https://cdn.tailwindcss.com"></script>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/lucide/0.263.1/lucide.min.js">
</head>
<body class="bg-gray-900">
  <div id="root"></div>
  <script type="text/babel">
    const { useState, useEffect } = React;
    
    // Iconos simples como componentes
    const Icon = ({ name, size = 18 }) => {
      const icons = {
        home: <svg xmlns="http://www.w3.org/2000/svg" width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="m3 9 9-7 9 7v11a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z"/><polyline points="9 22 9 12 15 12 15 22"/></svg>,
        package: <svg xmlns="http://www.w3.org/2000/svg" width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="m7.5 4.27 9 5.15"/><path d="M21 8a2 2 0 0 0-1-1.73l-7-4a2 2 0 0 0-2 0l-7 4A2 2 0 0 0 3 8v8a2 2 0 0 0 1 1.73l7 4a2 2 0 0 0 2 0l7-4A2 2 0 0 0 21 16Z"/><path d="m3.3 7 8.7 5 8.7-5"/><path d="M12 22V12"/></svg>,
        cart: <svg xmlns="http://www.w3.org/2000/svg" width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><circle cx="8" cy="21" r="1"/><circle cx="19" cy="21" r="1"/><path d="M2.05 2.05h2l2.66 12.42a2 2 0 0 0 2 1.58h9.78a2 2 0 0 0 1.95-1.57l1.65-7.43H5.12"/></svg>,
        list: <svg xmlns="http://www.w3.org/2000/svg" width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><rect width="8" height="4" x="8" y="2" rx="1" ry="1"/><path d="M16 4h2a2 2 0 0 1 2 2v14a2 2 0 0 1-2 2H6a2 2 0 0 1-2-2V6a2 2 0 0 1 2-2h2"/><path d="M12 11h4"/><path d="M12 16h4"/><path d="M8 11h.01"/><path d="M8 16h.01"/></svg>,
        settings: <svg xmlns="http://www.w3.org/2000/svg" width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M12.22 2h-.44a2 2 0 0 0-2 2v.18a2 2 0 0 1-1 1.73l-.43.25a2 2 0 0 1-2 0l-.15-.08a2 2 0 0 0-2.73.73l-.22.38a2 2 0 0 0 .73 2.73l.15.1a2 2 0 0 1 1 1.72v.51a2 2 0 0 1-1 1.74l-.15.09a2 2 0 0 0-.73 2.73l.22.38a2 2 0 0 0 2.73.73l.15-.08a2 2 0 0 1 2 0l.43.25a2 2 0 0 1 1 1.73V20a2 2 0 0 0 2 2h.44a2 2 0 0 0 2-2v-.18a2 2 0 0 1 1-1.73l.43-.25a2 2 0 0 1 2 0l.15.08a2 2 0 0 0 2.73-.73l.22-.39a2 2 0 0 0-.73-2.73l-.15-.08a2 2 0 0 1-1-1.74v-.5a2 2 0 0 1 1-1.74l.15-.09a2 2 0 0 0 .73-2.73l-.22-.38a2 2 0 0 0-2.73-.73l-.15.08a2 2 0 0 1-2 0l-.43-.25a2 2 0 0 1-1-1.73V4a2 2 0 0 0-2-2z"/><circle cx="12" cy="12" r="3"/></svg>,
        plus: <svg xmlns="http://www.w3.org/2000/svg" width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M5 12h14"/><path d="M12 5v14"/></svg>,
        minus: <svg xmlns="http://www.w3.org/2000/svg" width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M5 12h14"/></svg>,
        check: <svg xmlns="http://www.w3.org/2000/svg" width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><polyline points="20 6 9 17 4 12"/></svg>,
        trash: <svg xmlns="http://www.w3.org/2000/svg" width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M3 6h18"/><path d="M19 6v14c0 1-1 2-2 2H7c-1 0-2-1-2-2V6"/><path d="M8 6V4c0-1 1-2 2-2h4c1 0 2 1 2 2v2"/></svg>,
        alert: <svg xmlns="http://www.w3.org/2000/svg" width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="m21.73 18-8-14a2 2 0 0 0-3.48 0l-8 14A2 2 0 0 0 4 21h16a2 2 0 0 0 1.73-3Z"/><path d="M12 9v4"/><path d="M12 17h.01"/></svg>,
        calendar: <svg xmlns="http://www.w3.org/2000/svg" width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><rect width="18" height="18" x="3" y="4" rx="2" ry="2"/><line x1="16" x2="16" y1="2" y2="6"/><line x1="8" x2="8" y1="2" y2="6"/><line x1="3" x2="21" y1="10" y2="10"/></svg>
      };
      return icons[name] || null;
    };

    function App() {
      const [activeTab, setActiveTab] = useState('dashboard');
      const [loading, setLoading] = useState(true);
      const [properties, setProperties] = useState([]);
      const [inventories, setInventories] = useState({});
      const [kits, setKits] = useState({});
      const [reservations, setReservations] = useState([]);
      const [selectedProperty, setSelectedProperty] = useState('');
      const [newItem, setNewItem] = useState({ name: '', quantity: 0, unitCost: 0, minStock: 5 });
      const [newProperty, setNewProperty] = useState('');
      const [newKit, setNewKit] = useState({ name: '', items: [] });
      const [notification, setNotification] = useState(null);
      const [showCompleteModal, setShowCompleteModal] = useState(false);
      const [reservationDate, setReservationDate] = useState(new Date().toISOString().split('T')[0]);
      const [selectedReservationProperty, setSelectedReservationProperty] = useState('');
      const [showCelebration, setShowCelebration] = useState(false);
      const [confettiPieces, setConfettiPieces] = useState([]);

      useEffect(() => {
        loadData();
      }, []);

      useEffect(() => {
        if (properties.length > 0 && !selectedProperty) {
          setSelectedProperty(properties[0].id);
        }
      }, [properties]);

      const loadData = () => {
        try {
          const props = localStorage.getItem('airbnb_properties_v2');
          const inv = localStorage.getItem('airbnb_inventories_v2');
          const kitsData = localStorage.getItem('airbnb_kits_v2');
          const res = localStorage.getItem('airbnb_reservations_v2');
          
          if (props) setProperties(JSON.parse(props));
          if (inv) setInventories(JSON.parse(inv));
          if (kitsData) setKits(JSON.parse(kitsData));
          if (res) setReservations(JSON.parse(res));
        } catch (e) {
          console.log('Error loading:', e);
        }
        setLoading(false);
      };

      const saveData = (key, data) => {
        localStorage.setItem(key, JSON.stringify(data));
      };

      const showNotification = (msg, type = 'success') => {
        setNotification({ msg, type });
        setTimeout(() => setNotification(null), 3000);
      };

      const playSuccessSound = () => {
        try {
          const audioContext = new (window.AudioContext || window.webkitAudioContext)();
          const notes = [523.25, 659.25, 783.99, 1046.50];
          notes.forEach((freq, i) => {
            const oscillator = audioContext.createOscillator();
            const gainNode = audioContext.createGain();
            oscillator.connect(gainNode);
            gainNode.connect(audioContext.destination);
            oscillator.frequency.value = freq;
            oscillator.type = 'sine';
            gainNode.gain.setValueAtTime(0.3, audioContext.currentTime + i * 0.15);
            gainNode.gain.exponentialRampToValueAtTime(0.01, audioContext.currentTime + i * 0.15 + 0.3);
            oscillator.start(audioContext.currentTime + i * 0.15);
            oscillator.stop(audioContext.currentTime + i * 0.15 + 0.3);
          });
        } catch(e) {}
      };

      const triggerCelebration = () => {
        const pieces = [];
        const colors = ['#FFD700', '#FF6B6B', '#4ECDC4', '#45B7D1', '#96CEB4', '#FFEAA7', '#DDA0DD', '#98D8C8'];
        for (let i = 0; i < 80; i++) {
          pieces.push({
            id: i,
            x: Math.random() * 100,
            color: colors[Math.floor(Math.random() * colors.length)],
            delay: Math.random() * 0.5,
            rotation: Math.random() * 360,
            size: Math.random() * 10 + 5
          });
        }
        setConfettiPieces(pieces);
        setShowCelebration(true);
        playSuccessSound();
        setTimeout(() => {
          setShowCelebration(false);
          setConfettiPieces([]);
        }, 3000);
      };

      const addProperty = () => {
        if (!newProperty.trim()) return;
        const newProp = { id: Date.now().toString(), name: newProperty };
        const updatedProps = [...properties, newProp];
        const updatedInv = { ...inventories, [newProp.id]: [] };
        const updatedKits = { ...kits, [newProp.id]: null };
        
        setProperties(updatedProps);
        setInventories(updatedInv);
        setKits(updatedKits);
        setSelectedProperty(newProp.id);
        
        saveData('airbnb_properties_v2', updatedProps);
        saveData('airbnb_inventories_v2', updatedInv);
        saveData('airbnb_kits_v2', updatedKits);
        setNewProperty('');
        showNotification('Propiedad agregada');
      };

      const deleteProperty = (id) => {
        const updated = properties.filter(p => p.id !== id);
        const { [id]: removedInv, ...restInv } = inventories;
        const { [id]: removedKit, ...restKits } = kits;
        
        setProperties(updated);
        setInventories(restInv);
        setKits(restKits);
        
        if (selectedProperty === id && updated.length > 0) {
          setSelectedProperty(updated[0].id);
        }
        
        saveData('airbnb_properties_v2', updated);
        saveData('airbnb_inventories_v2', restInv);
        saveData('airbnb_kits_v2', restKits);
      };

      const currentInventory = inventories[selectedProperty] || [];
      const currentKit = kits[selectedProperty];

      const addInventoryItem = () => {
        if (!newItem.name || newItem.quantity <= 0 || !selectedProperty) return;
        const updatedInv = {
          ...inventories,
          [selectedProperty]: [...currentInventory, { ...newItem, id: Date.now().toString() }]
        };
        setInventories(updatedInv);
        saveData('airbnb_inventories_v2', updatedInv);
        setNewItem({ name: '', quantity: 0, unitCost: 0, minStock: 5 });
        showNotification('Producto agregado');
      };

      const updateInventoryQty = (id, delta) => {
        const updatedInv = {
          ...inventories,
          [selectedProperty]: currentInventory.map(item =>
            item.id === id ? { ...item, quantity: Math.max(0, item.quantity + delta) } : item
          )
        };
        setInventories(updatedInv);
        saveData('airbnb_inventories_v2', updatedInv);
      };

      const deleteInventoryItem = (id) => {
        const updatedInv = {
          ...inventories,
          [selectedProperty]: currentInventory.filter(i => i.id !== id)
        };
        setInventories(updatedInv);
        saveData('airbnb_inventories_v2', updatedInv);
      };

      const saveKit = () => {
        if (newKit.items.length === 0) {
          showNotification('Agrega al menos 1 item al kit', 'error');
          return;
        }
        const updatedKits = {
          ...kits,
          [selectedProperty]: { name: newKit.name || 'Kit Est√°ndar', items: newKit.items }
        };
        setKits(updatedKits);
        saveData('airbnb_kits_v2', updatedKits);
        showNotification('Kit guardado');
      };

      const updateKitItem = (itemId, qty) => {
        const existing = newKit.items.find(i => i.itemId === itemId);
        if (existing) {
          if (qty <= 0) {
            setNewKit({ ...newKit, items: newKit.items.filter(i => i.itemId !== itemId) });
          } else {
            setNewKit({ ...newKit, items: newKit.items.map(i => i.itemId === itemId ? { ...i, qty } : i) });
          }
        } else if (qty > 0) {
          setNewKit({ ...newKit, items: [...newKit.items, { itemId, qty }] });
        }
      };

      const loadKitForEditing = (propId) => {
        const kit = kits[propId];
        if (kit) {
          setNewKit({ name: kit.name, items: [...kit.items] });
        } else {
          setNewKit({ name: '', items: [] });
        }
      };

      useEffect(() => {
        if (selectedProperty && activeTab === 'kits') {
          loadKitForEditing(selectedProperty);
        }
      }, [selectedProperty, activeTab]);

      const completeReservation = (propertyId) => {
        const kit = kits[propertyId];
        const inv = inventories[propertyId] || [];
        const prop = properties.find(p => p.id === propertyId);
        
        if (!kit || kit.items.length === 0) {
          showNotification('Esta propiedad no tiene kit configurado', 'error');
          return;
        }

        let canComplete = true;
        let missingItems = [];
        
        for (const kitItem of kit.items) {
          const invItem = inv.find(i => i.id === kitItem.itemId);
          if (!invItem || invItem.quantity < kitItem.qty) {
            canComplete = false;
            missingItems.push(invItem?.name || 'Item desconocido');
          }
        }

        if (!canComplete) {
          showNotification(`Stock insuficiente: ${missingItems.join(', ')}`, 'error');
          return;
        }

        const updatedPropertyInv = inv.map(item => {
          const kitItem = kit.items.find(ki => ki.itemId === item.id);
          if (kitItem) {
            return { ...item, quantity: item.quantity - kitItem.qty };
          }
          return item;
        });

        const updatedInv = { ...inventories, [propertyId]: updatedPropertyInv };

        const totalCost = kit.items.reduce((sum, ki) => {
          const item = inv.find(i => i.id === ki.itemId);
          return sum + (item ? item.unitCost * ki.qty : 0);
        }, 0);

        const newRes = {
          id: Date.now().toString(),
          date: reservationDate,
          createdAt: new Date().toISOString(),
          propertyId,
          propertyName: prop?.name || 'Desconocida',
          kitName: kit.name,
          items: kit.items.map(ki => {
            const item = inv.find(i => i.id === ki.itemId);
            return { name: item?.name, qty: ki.qty, unitCost: item?.unitCost || 0 };
          }),
          totalCost
        };

        const updatedRes = [newRes, ...reservations];
        
        setInventories(updatedInv);
        setReservations(updatedRes);
        saveData('airbnb_inventories_v2', updatedInv);
        saveData('airbnb_reservations_v2', updatedRes);
        
        setShowCompleteModal(false);
        setSelectedReservationProperty('');
        triggerCelebration();
        showNotification(`‚úì Reserva completada en ${prop?.name} - Costo: $${totalCost.toLocaleString()}`);
      };

      const getLowStockItems = (propId) => {
        const inv = inventories[propId] || [];
        return inv.filter(i => i.quantity <= i.minStock);
      };

      const getPropertyStats = (propId) => {
        const inv = inventories[propId] || [];
        const propRes = reservations.filter(r => r.propertyId === propId);
        const thisMonth = propRes.filter(r => new Date(r.date).getMonth() === new Date().getMonth());
        return {
          inventoryValue: inv.reduce((sum, i) => sum + (i.quantity * i.unitCost), 0),
          totalReservations: propRes.length,
          monthReservations: thisMonth.length,
          monthCost: thisMonth.reduce((sum, r) => sum + r.totalCost, 0)
        };
      };

      const totalStats = {
        monthReservations: reservations.filter(r => new Date(r.date).getMonth() === new Date().getMonth()).length,
        monthCost: reservations.filter(r => new Date(r.date).getMonth() === new Date().getMonth()).reduce((s, r) => s + r.totalCost, 0),
        totalValue: Object.values(inventories).flat().reduce((sum, i) => sum + (i.quantity * i.unitCost), 0)
      };

      if (loading) {
        return <div className="min-h-screen bg-gray-900 text-white flex items-center justify-center">Cargando...</div>;
      }

      const selectedProp = properties.find(p => p.id === selectedProperty);

      return (
        <div className="min-h-screen bg-gray-900 text-white">
          {notification && (
            <div className={`fixed top-4 right-4 px-4 py-3 rounded-lg z-50 shadow-lg ${notification.type === 'error' ? 'bg-red-600' : 'bg-green-600'}`}>
              {notification.msg}
            </div>
          )}

          {showCelebration && (
            <div className="fixed inset-0 pointer-events-none z-[100]">
              {confettiPieces.map(piece => (
                <div
                  key={piece.id}
                  style={{
                    position: 'absolute',
                    left: `${piece.x}%`,
                    top: '-20px',
                    width: piece.size,
                    height: piece.size,
                    backgroundColor: piece.color,
                    borderRadius: Math.random() > 0.5 ? '50%' : '0%',
                    transform: `rotate(${piece.rotation}deg)`,
                    animation: `fall 2.5s ease-out ${piece.delay}s forwards`
                  }}
                />
              ))}
              <style>{`
                @keyframes fall {
                  0% { transform: translateY(0) rotate(0deg); opacity: 1; }
                  100% { transform: translateY(100vh) rotate(720deg); opacity: 0; }
                }
              `}</style>
            </div>
          )}

          {showCompleteModal && (
            <div className="fixed inset-0 bg-black/70 flex items-center justify-center z-50 p-4">
              <div className="bg-gray-800 rounded-xl p-6 w-full max-w-md">
                <h2 className="text-xl font-bold mb-4 flex items-center gap-2">
                  <Icon name="check" /> Completar Reserva
                </h2>
                
                <div className="mb-4">
                  <label className="text-sm text-gray-400 block mb-2">Fecha de la reserva</label>
                  <input
                    type="date"
                    value={reservationDate}
                    onChange={e => setReservationDate(e.target.value)}
                    className="w-full bg-gray-700 rounded-lg px-4 py-3 text-white"
                  />
                </div>
                
                <div className="mb-4">
                  <label className="text-sm text-gray-400 block mb-2">Selecciona la propiedad</label>
                  <div className="space-y-2">
                    {properties.map(prop => {
                      const kit = kits[prop.id];
                      const hasKit = kit && kit.items.length > 0;
                      const kitCost = hasKit ? kit.items.reduce((sum, ki) => {
                        const item = (inventories[prop.id] || []).find(i => i.id === ki.itemId);
                        return sum + (item ? item.unitCost * ki.qty : 0);
                      }, 0) : 0;
                      const isSelected = selectedReservationProperty === prop.id;
                      
                      return (
                        <button
                          key={prop.id}
                          onClick={() => hasKit && setSelectedReservationProperty(prop.id)}
                          disabled={!hasKit}
                          className={`w-full p-4 rounded-lg text-left transition border-2 ${
                            isSelected 
                              ? 'bg-green-700 border-green-400' 
                              : hasKit 
                                ? 'bg-gray-700 border-transparent hover:border-green-600' 
                                : 'bg-gray-700 opacity-50 cursor-not-allowed border-transparent'
                          }`}
                        >
                          <div className="flex items-center justify-between">
                            <div>
                              <p className="font-semibold text-lg">{prop.name}</p>
                              {hasKit ? (
                                <p className="text-sm text-gray-300">Kit: {kit.name} ‚Ä¢ Costo: ${kitCost.toLocaleString()}</p>
                              ) : (
                                <p className="text-sm text-gray-400">Sin kit configurado</p>
                              )}
                            </div>
                            {isSelected && (
                              <div className="bg-green-500 rounded-full p-1">
                                <Icon name="check" size={20} />
                              </div>
                            )}
                          </div>
                        </button>
                      );
                    })}
                  </div>
                </div>
                
                <button
                  onClick={() => selectedReservationProperty && completeReservation(selectedReservationProperty)}
                  disabled={!selectedReservationProperty}
                  className={`w-full py-4 rounded-xl font-bold text-lg mb-3 flex items-center justify-center gap-3 transition-all ${
                    selectedReservationProperty 
                      ? 'bg-gradient-to-r from-green-500 to-emerald-400 hover:from-green-400 hover:to-emerald-300' 
                      : 'bg-gray-600 cursor-not-allowed opacity-50'
                  }`}
                >
                  <span className="text-2xl">üéâ</span>
                  PROCESAR RESERVA
                  <span className="text-2xl">üéâ</span>
                </button>
                
                <button
                  onClick={() => {
                    setShowCompleteModal(false);
                    setSelectedReservationProperty('');
                  }}
                  className="w-full bg-gray-700 hover:bg-gray-600 py-3 rounded-lg"
                >
                  Cancelar
                </button>
              </div>
            </div>
          )}
          
          <nav className="bg-gray-800 border-b border-gray-700 px-4 py-3">
            <div className="flex gap-2 overflow-x-auto">
              {[
                { id: 'dashboard', icon: 'home', label: 'Inicio' },
                { id: 'inventory', icon: 'package', label: 'Inventario' },
                { id: 'kits', icon: 'cart', label: 'Kits' },
                { id: 'reservations', icon: 'list', label: 'Historial' },
                { id: 'properties', icon: 'settings', label: 'Propiedades' }
              ].map(tab => (
                <button
                  key={tab.id}
                  onClick={() => setActiveTab(tab.id)}
                  className={`flex items-center gap-2 px-4 py-2 rounded-lg whitespace-nowrap transition ${activeTab === tab.id ? 'bg-blue-600' : 'bg-gray-700 hover:bg-gray-600'}`}
                >
                  <Icon name={tab.icon} size={18} />
                  <span className="text-sm">{tab.label}</span>
                </button>
              ))}
            </div>
          </nav>

          <main className="p-4 max-w-4xl mx-auto">
            {activeTab === 'dashboard' && (
              <div className="space-y-4">
                <h1 className="text-2xl font-bold">Dashboard</h1>

                <button
                  onClick={() => {
                    setReservationDate(new Date().toISOString().split('T')[0]);
                    setShowCompleteModal(true);
                  }}
                  disabled={properties.length === 0}
                  className="w-full bg-gradient-to-r from-green-600 to-green-500 hover:from-green-500 hover:to-green-400 disabled:opacity-50 py-6 rounded-xl text-xl font-bold flex items-center justify-center gap-3 shadow-lg"
                >
                  <Icon name="check" size={32} />
                  RESERVA COMPLETADA
                </button>
                
                <div className="grid grid-cols-3 gap-3">
                  <div className="bg-gray-800 p-4 rounded-lg">
                    <p className="text-gray-400 text-xs">Propiedades</p>
                    <p className="text-2xl font-bold">{properties.length}</p>
                  </div>
                  <div className="bg-gray-800 p-4 rounded-lg">
                    <p className="text-gray-400 text-xs">Reservas Mes</p>
                    <p className="text-2xl font-bold">{totalStats.monthReservations}</p>
                  </div>
                  <div className="bg-gray-800 p-4 rounded-lg">
                    <p className="text-gray-400 text-xs">Gasto Mes</p>
                    <p className="text-xl font-bold text-green-400">${totalStats.monthCost.toLocaleString()}</p>
                  </div>
                </div>

                {properties.length === 0 ? (
                  <div className="bg-gray-800 rounded-lg p-6 text-center">
                    <p className="text-gray-400 mb-4">Comienza agregando tus propiedades</p>
                    <button onClick={() => setActiveTab('properties')} className="bg-blue-600 hover:bg-blue-500 px-6 py-2 rounded-lg">
                      Agregar Propiedad
                    </button>
                  </div>
                ) : (
                  <div className="space-y-3">
                    {properties.map(prop => {
                      const stats = getPropertyStats(prop.id);
                      const lowStock = getLowStockItems(prop.id);
                      const kit = kits[prop.id];
                      
                      return (
                        <div key={prop.id} className="bg-gray-800 rounded-lg p-4">
                          <div className="flex justify-between items-start mb-3">
                            <div>
                              <h3 className="font-bold text-lg">{prop.name}</h3>
                              <p className="text-sm text-gray-400">
                                {stats.monthReservations} reservas este mes ‚Ä¢ ${stats.monthCost.toLocaleString()}
                              </p>
                            </div>
                            <div className="text-right">
                              <p className="text-xs text-gray-400">Inventario</p>
                              <p className="font-semibold">${stats.inventoryValue.toLocaleString()}</p>
                            </div>
                          </div>
                          
                          {!kit || kit.items.length === 0 ? (
                            <div className="bg-yellow-900/30 border border-yellow-700 rounded-lg p-3 text-sm">
                              <p className="text-yellow-500">‚ö†Ô∏è Sin kit configurado</p>
                            </div>
                          ) : lowStock.length > 0 ? (
                            <div className="bg-red-900/30 border border-red-700 rounded-lg p-3">
                              <p className="text-red-400 text-sm flex items-center gap-1">
                                <Icon name="alert" size={14} /> Stock bajo: {lowStock.map(i => i.name).join(', ')}
                              </p>
                            </div>
                          ) : (
                            <div className="bg-green-900/30 border border-green-700 rounded-lg p-3">
                              <p className="text-green-400 text-sm">‚úì Inventario OK</p>
                            </div>
                          )}
                        </div>
                      );
                    })}
                  </div>
                )}
              </div>
            )}

            {activeTab === 'inventory' && (
              <div className="space-y-4">
                <h1 className="text-2xl font-bold">Inventario</h1>

                {properties.length === 0 ? (
                  <div className="bg-gray-800 rounded-lg p-6 text-center">
                    <p className="text-gray-400">Primero agrega una propiedad</p>
                  </div>
                ) : (
                  <>
                    <div className="flex gap-2 overflow-x-auto pb-2">
                      {properties.map(prop => (
                        <button
                          key={prop.id}
                          onClick={() => setSelectedProperty(prop.id)}
                          className={`px-4 py-2 rounded-lg whitespace-nowrap transition ${selectedProperty === prop.id ? 'bg-blue-600' : 'bg-gray-700 hover:bg-gray-600'}`}
                        >
                          {prop.name}
                        </button>
                      ))}
                    </div>

                    <div className="bg-gray-800 p-4 rounded-lg space-y-3">
                      <h3 className="font-semibold">Agregar a {selectedProp?.name}</h3>
                      <input
                        type="text"
                        placeholder="Nombre (ej: Esponjas)"
                        value={newItem.name}
                        onChange={e => setNewItem({ ...newItem, name: e.target.value })}
                        className="w-full bg-gray-700 rounded px-3 py-2 text-white"
                      />
                      <div className="grid grid-cols-3 gap-2">
                        <div>
                          <label className="text-xs text-gray-400">Cantidad</label>
                          <input
                            type="number"
                            value={newItem.quantity || ''}
                            onChange={e => setNewItem({ ...newItem, quantity: parseInt(e.target.value) || 0 })}
                            className="w-full bg-gray-700 rounded px-3 py-2 text-white"
                          />
                        </div>
                        <div>
                          <label className="text-xs text-gray-400">Costo Unit.</label>
                          <input
                            type="number"
                            value={newItem.unitCost || ''}
                            onChange={e => setNewItem({ ...newItem, unitCost: parseInt(e.target.value) || 0 })}
                            className="w-full bg-gray-700 rounded px-3 py-2 text-white"
                          />
                        </div>
                        <div>
                          <label className="text-xs text-gray-400">Stock M√≠n.</label>
                          <input
                            type="number"
                            value={newItem.minStock || ''}
                            onChange={e => setNewItem({ ...newItem, minStock: parseInt(e.target.value) || 0 })}
                            className="w-full bg-gray-700 rounded px-3 py-2 text-white"
                          />
                        </div>
                      </div>
                      <button onClick={addInventoryItem} className="w-full bg-blue-600 hover:bg-blue-500 py-2 rounded-lg flex items-center justify-center gap-2">
                        <Icon name="plus" size={18} /> Agregar
                      </button>
                    </div>

                    <div className="space-y-2">
                      {currentInventory.map(item => (
                        <div key={item.id} className={`bg-gray-800 p-3 rounded-lg flex items-center justify-between ${item.quantity <= item.minStock ? 'border border-yellow-600' : ''}`}>
                          <div>
                            <p className="font-medium">{item.name}</p>
                            <p className="text-sm text-gray-400">${item.unitCost.toLocaleString()} c/u ‚Ä¢ M√≠n: {item.minStock}</p>
                          </div>
                          <div className="flex items-center gap-2">
                            <button onClick={() => updateInventoryQty(item.id, -1)} className="bg-gray-700 p-2 rounded hover:bg-gray-600">
                              <Icon name="minus" size={16} />
                            </button>
                            <span className="w-12 text-center font-bold">{item.quantity}</span>
                            <button onClick={() => updateInventoryQty(item.id, 1)} className="bg-gray-700 p-2 rounded hover:bg-gray-600">
                              <Icon name="plus" size={16} />
                            </button>
                            <button onClick={() => deleteInventoryItem(item.id)} className="bg-red-700 p-2 rounded hover:bg-red-600 ml-2">
                              <Icon name="trash" size={16} />
                            </button>
                          </div>
                        </div>
                      ))}
                      {currentInventory.length === 0 && (
                        <p className="text-gray-400 text-center py-8">No hay productos en {selectedProp?.name}</p>
                      )}
                    </div>
                  </>
                )}
              </div>
            )}

            {activeTab === 'kits' && (
              <div className="space-y-4">
                <h1 className="text-2xl font-bold">Kit por Propiedad</h1>
                
                {properties.length === 0 ? (
                  <div className="bg-gray-800 rounded-lg p-6 text-center">
                    <p className="text-gray-400">Primero agrega una propiedad</p>
                  </div>
                ) : (
                  <>
                    <div className="flex gap-2 overflow-x-auto pb-2">
                      {properties.map(prop => (
                        <button
                          key={prop.id}
                          onClick={() => setSelectedProperty(prop.id)}
                          className={`px-4 py-2 rounded-lg whitespace-nowrap transition ${selectedProperty === prop.id ? 'bg-blue-600' : 'bg-gray-700 hover:bg-gray-600'}`}
                        >
                          {prop.name}
                        </button>
                      ))}
                    </div>

                    <div className="bg-gray-800 p-4 rounded-lg space-y-3">
                      <h3 className="font-semibold">Kit para {selectedProp?.name}</h3>
                      <input
                        type="text"
                        placeholder="Nombre del kit (ej: Kit Est√°ndar)"
                        value={newKit.name}
                        onChange={e => setNewKit({ ...newKit, name: e.target.value })}
                        className="w-full bg-gray-700 rounded px-3 py-2 text-white"
                      />
                      
                      {currentInventory.length > 0 ? (
                        <div className="space-y-2">
                          <p className="text-sm text-gray-400">¬øCu√°nto se usa por reserva?</p>
                          {currentInventory.map(item => {
                            const kitItem = newKit.items.find(i => i.itemId === item.id);
                            return (
                              <div key={item.id} className="flex items-center justify-between bg-gray-700 p-3 rounded">
                                <div>
                                  <span className="font-medium">{item.name}</span>
                                  <span className="text-gray-400 text-sm ml-2">(hay {item.quantity})</span>
                                </div>
                                <div className="flex items-center gap-2">
                                  <button onClick={() => updateKitItem(item.id, (kitItem?.qty || 0) - 1)} className="bg-gray-600 p-2 rounded hover:bg-gray-500">
                                    <Icon name="minus" size={14} />
                                  </button>
                                  <span className="w-10 text-center font-bold">{kitItem?.qty || 0}</span>
                                  <button onClick={() => updateKitItem(item.id, (kitItem?.qty || 0) + 1)} className="bg-gray-600 p-2 rounded hover:bg-gray-500">
                                    <Icon name="plus" size={14} />
                                  </button>
                                </div>
                              </div>
                            );
                          })}
                        </div>
                      ) : (
                        <p className="text-gray-400 text-sm">Primero agrega productos al inventario de esta propiedad</p>
                      )}

                      {newKit.items.length > 0 && (
                        <div className="bg-gray-700 p-3 rounded-lg">
                          <p className="text-sm text-gray-400">Costo por reserva:</p>
                          <p className="text-xl font-bold text-green-400">
                            ${newKit.items.reduce((sum, ki) => {
                              const item = currentInventory.find(i => i.id === ki.itemId);
                              return sum + (item ? item.unitCost * ki.qty : 0);
                            }, 0).toLocaleString()}
                          </p>
                        </div>
                      )}
                      
                      <button onClick={saveKit} className="w-full bg-green-600 hover:bg-green-500 py-3 rounded-lg font-semibold">
                        Guardar Kit
                      </button>
                    </div>
                  </>
                )}
              </div>
            )}

            {activeTab === 'reservations' && (
              <div className="space-y-4">
                <h1 className="text-2xl font-bold">Historial de Reservas</h1>
                
                <div className="grid grid-cols-2 gap-4">
                  <div className="bg-gray-800 p-4 rounded-lg">
                    <p className="text-gray-400 text-sm">Este Mes</p>
                    <p className="text-2xl font-bold">{totalStats.monthReservations}</p>
                    <p className="text-green-400">${totalStats.monthCost.toLocaleString()}</p>
                  </div>
                  <div className="bg-gray-800 p-4 rounded-lg">
                    <p className="text-gray-400 text-sm">Total</p>
                    <p className="text-2xl font-bold">{reservations.length}</p>
                    <p className="text-green-400">${reservations.reduce((s, r) => s + r.totalCost, 0).toLocaleString()}</p>
                  </div>
                </div>

                <div className="space-y-2">
                  {reservations.map(res => (
                    <div key={res.id} className="bg-gray-800 p-4 rounded-lg">
                      <div className="flex justify-between items-start">
                        <div>
                          <p className="font-semibold">{res.propertyName}</p>
                          <p className="text-sm text-gray-400">{res.kitName}</p>
                        </div>
                        <div className="text-right">
                          <p className="font-bold text-green-400">${res.totalCost.toLocaleString()}</p>
                          <p className="text-xs text-gray-400 flex items-center gap-1 justify-end">
                            <Icon name="calendar" size={12} />
                            {new Date(res.date).toLocaleDateString('es-CL')}
                          </p>
                        </div>
                      </div>
                      <div className="mt-2 text-xs text-gray-400">
                        {res.items.map((i, idx) => (
                          <span key={idx} className="mr-2">‚Ä¢ {i.name}: {i.qty}</span>
                        ))}
                      </div>
                    </div>
                  ))}
                  {reservations.length === 0 && (
                    <p className="text-gray-400 text-center py-8">No hay reservas registradas</p>
                  )}
                </div>
              </div>
            )}

            {activeTab === 'properties' && (
              <div className="space-y-4">
                <h1 className="text-2xl font-bold">Propiedades</h1>
                
                <div className="bg-gray-800 p-4 rounded-lg flex gap-2">
                  <input
                    type="text"
                    placeholder="Nombre de la propiedad"
                    value={newProperty}
                    onChange={e => setNewProperty(e.target.value)}
                    className="flex-1 bg-gray-700 rounded px-3 py-2 text-white"
                  />
                  <button onClick={addProperty} className="bg-blue-600 hover:bg-blue-500 px-4 py-2 rounded-lg">
                    <Icon name="plus" size={20} />
                  </button>
                </div>

                <div className="space-y-2">
                  {properties.map(prop => {
                    const stats = getPropertyStats(prop.id);
                    const inv = inventories[prop.id] || [];
                    const kit = kits[prop.id];
                    
                    return (
                      <div key={prop.id} className="bg-gray-800 p-4 rounded-lg">
                        <div className="flex justify-between items-start">
                          <div>
                            <p className="font-semibold text-lg">{prop.name}</p>
                            <p className="text-sm text-gray-400">
                              {inv.length} productos ‚Ä¢ {stats.totalReservations} reservas
                            </p>
                            <p className="text-sm text-gray-400">
                              Kit: {kit && kit.items.length > 0 ? `${kit.name} (${kit.items.length} items)` : 'No configurado'}
                            </p>
                          </div>
                          <button onClick={() => deleteProperty(prop.id)} className="bg-red-700 hover:bg-red-600 p-2 rounded">
                            <Icon name="trash" size={16} />
                          </button>
                        </div>
                      </div>
                    );
                  })}
                  {properties.length === 0 && (
                    <p className="text-gray-400 text-center py-8">No hay propiedades agregadas</p>
                  )}
                </div>
              </div>
            )}
          </main>
        </div>
      );
    }

    ReactDOM.render(<App />, document.getElementById('root'));
  </script>
</body>
</html>
